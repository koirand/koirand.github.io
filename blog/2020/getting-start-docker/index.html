<!DOCTYPE html>
<html>
  <head>
  <title>
      
          Docker入門 - Kazuki Koide
      
  </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Kazuki Koide" />
  <link rel="shortcut icon" type="image/x-icon" href="https://koirand.github.io/img/favicon.ico">

  
  
  
  
  
  <link rel="stylesheet" href="https://koirand.github.io/style.min.99cce017d17cc3da34964bba0051540f661dc4960ecad5ef9ad9c624a1c2e11b.css" integrity="sha256-mczgF9F8w9o0lku6AFFUD2YdxJYOytXvmtnGJKHC4Rs=">
  
  
  
  <link rel="stylesheet" href="https://koirand.github.io/style-dark.min.0a647fb6c07e04b77b54fa0515d0a683d39ecdb251dba960fe1f966f7ff36fc2.css" media="(prefers-color-scheme: dark)" integrity="sha256-CmR/tsB&#43;BLd7VPoFFdCmg9OezbJR26lg/h&#43;Wb3/zb8I=">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  
  

  <meta property="og:title" content="Docker入門" />
<meta property="og:description" content="社内でDocker入門講座を開催した時に作った資料。 公式ドキュメント Docker Documentation Docker ドキュメント日本語化プロジェクト Dockerとはなんぞや Docke" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://koirand.github.io/blog/2020/getting-start-docker/" /><meta property="og:image" content="https://i.imgur.com/QXMlFGO.png" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2020-02-05T11:55:24&#43;09:00" />
<meta property="article:modified_time" content="2020-02-05T11:55:24&#43;09:00" />

<meta itemprop="name" content="Docker入門">
<meta itemprop="description" content="社内でDocker入門講座を開催した時に作った資料。 公式ドキュメント Docker Documentation Docker ドキュメント日本語化プロジェクト Dockerとはなんぞや Docke"><meta itemprop="datePublished" content="2020-02-05T11:55:24&#43;09:00" />
<meta itemprop="dateModified" content="2020-02-05T11:55:24&#43;09:00" />
<meta itemprop="wordCount" content="7033"><meta itemprop="image" content="https://i.imgur.com/QXMlFGO.png">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://i.imgur.com/QXMlFGO.png"/>

<meta name="twitter:title" content="Docker入門"/>
<meta name="twitter:description" content="社内でDocker入門講座を開催した時に作った資料。 公式ドキュメント Docker Documentation Docker ドキュメント日本語化プロジェクト Dockerとはなんぞや Docke"/>

  <!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->

  <!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
  <![endif]-->

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-126342153-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</head>

  <body>
    
  <h1>Docker入門</h1>
  <header>
  
  <div class="avatar">
    <img class="avatarMask" src="https://koirand.github.io/img/avatar.png" alt="">
    <a href="https://koirand.github.io"><img class="avatar-border" src="https://koirand.github.io/img/avatar-border.svg" alt=""></a>
  </div>
  
  <h2><a class="author" href="https://koirand.github.io">Kazuki Koide</a></h2>
</header>

  
  
  
  <p class="date">February 5, 2020</p>
  
  
  
  
  <div id="contentBody">
    <p>社内でDocker入門講座を開催した時に作った資料。</p>
<hr>
<h2 id="公式ドキュメント">公式ドキュメント</h2>
<ul>
<li><a href="https://docs.docker.com/">Docker Documentation</a></li>
<li><a href="http://docs.docker.jp/index.html">Docker ドキュメント日本語化プロジェクト</a></li>
</ul>
<h2 id="dockerとはなんぞや">Dockerとはなんぞや</h2>
<ul>
<li>Dockerは仮想化技術の一つ(VirtualBOX, HyperVと同じくくり)</li>
<li>OS(カーネル)の上にコンテナ層を作ることを発明した</li>
<li>Linuxしか動かせないが、その代わり軽くて速い</li>
<li>コンテナはDockerイメージ(isoイメージみたいなやつ)をもとに生成できる</li>
<li>色々なDockerイメージがDockerHubで公開されている</li>
</ul>
<h2 id="何が嬉しいの">何が嬉しいの？</h2>
<ul>
<li>起動が早くてキビキビ動くので、取り回しやすい</li>
<li>リソース消費量が少ないので、1プロセス1コンテナみたいな世界が可能になる</li>
<li>イメージのサイズが小さいのとDockerHubがあるおかげで公開がとても楽</li>
</ul>
<h2 id="インストール">インストール</h2>
<p>公式サイトでDocker Desktopのインストーラーをダウンロードしてインストールしてください。</p>
<p>WindowsにDocker toolboxをインストールしている記事を見かけることがありますが、2020年2月時点ではDocker toolboxは廃止されて非推奨となっているようです。</p>
<h2 id="基本的なコマンド一覧">基本的なコマンド一覧</h2>
<p>結構種類があって大変ですが、この後ひとつひとつ実行して動作確認していきます。</p>
<h4 id="コンテナ操作系">コンテナ操作系</h4>
<table>
<thead>
<tr>
<th>コマンド</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>docker run</td>
<td>コンテナを生成して起動する</td>
</tr>
<tr>
<td>docker exec</td>
<td>コンテナ内でコマンドを実行する</td>
</tr>
<tr>
<td>docker ps</td>
<td>コンテナの状態を参照する</td>
</tr>
<tr>
<td>docker stop</td>
<td>コンテナを停止する</td>
</tr>
<tr>
<td>docker start</td>
<td>コンテナを起動する</td>
</tr>
<tr>
<td>docker rm</td>
<td>コンテナを削除する</td>
</tr>
<tr>
<td>docker logs</td>
<td>コンテナのログを参照する</td>
</tr>
</tbody>
</table>
<h4 id="dockerイメージ操作系">Dockerイメージ操作系</h4>
<table>
<thead>
<tr>
<th>コマンド</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>docker images</td>
<td>Dockerイメージの一覧を参照する</td>
</tr>
<tr>
<td>docker rmi</td>
<td>Dockerイメージを削除する</td>
</tr>
<tr>
<td>docker commit</td>
<td>コンテナに対して行った変更をDockerイメージとして保存する</td>
</tr>
<tr>
<td>docker build</td>
<td>DockerfileからDockerイメージを作成する</td>
</tr>
<tr>
<td>docker login</td>
<td>Dockerイメージのリポジトリサイトにログインする</td>
</tr>
<tr>
<td>docker push</td>
<td>リポジトリにDockerイメージを格納する</td>
</tr>
</tbody>
</table>
<p>他にも色々ありますので、気になる人は<code>docker --help</code>で確認してみてください。</p>
<h2 id="チュートリアル１コンテナを操る">チュートリアル１（コンテナを操る）</h2>
<p>チュートリアル１ではdockerコマンドを実際に叩いてみて、Dockerに慣れていきましょう。</p>
<h3 id="nginxをdocker上で起動する">NginxをDocker上で起動する</h3>
<p>以下の通り<code>docker run</code>コマンドを実行してください。</p>
<pre><code>$ docker run -d -p 8080:80 --name=nginx nginx:latest

Unable to find image 'nginx:latest' locally
latest: Pulling from library/nginx
bc51dd8edc1b: Pull complete
66ba67045f57: Pull complete
bf317aa10aa5: Pull complete
Digest: sha256:ad5552c786f128e389a0263104ae39f3d3c7895579d45ae716f528185b36bc6f
Status: Downloaded newer image for nginx:latest
6a4692e3ff5f601b1c81c7a720888251b5b7ac3fe0d02bb90de736488a35f28b
</code></pre>
<p><code>docker run</code>を実行すると、DockerHubからDockerイメージがダウンロードされ、それを使ってコンテナが生成されます(docker run のオプションについてはマニュアルを参考にしてください)。<a href="http://localhost:8080">http://localhost:8080</a> にアクセスするとNginxが起動しているのが確認できるかと思います。</p>
<p><img src="https://i.imgur.com/8sfOE8N.png" alt="nginx"></p>
<p>コマンド内の<code>nginx:latest</code>という部分がDockerイメージの識別子になります。Dockerイメージは<code>{リポジトリ名}:{タグ}</code>で一意に識別されるので覚えておいてください。latestタグは最新バージョンのDockerイメージに付与されるタグです。もし<code>docker run</code>実行時にタグを省略した場合は、latestタグが使用されます。</p>
<h3 id="コンテナの状態を確認してみる">コンテナの状態を確認してみる</h3>
<p><code>docker images</code>でDockerイメージの一覧を表示できます。</p>
<pre><code>$ docker images

REPOSITORY   TAG       IMAGE ID          CREATED         SIZE
nginx        latest    2073e0bcb60e      44 hours ago    127MB
</code></pre>
<p>Dockerイメージの一覧にnginxが追加されているかと思います。これが先程<code>docker run</code>実行時にDockerHubからダウンロードされたDockerイメージです。</p>
<p>次にコンテナの状態を<code>docker ps</code>で確認しましょう。</p>
<pre><code>$ docker ps

CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
4e3aa2d731f3        nginx:latest        &quot;nginx -g 'daemon of…&quot;   3 seconds ago       Up 2 seconds        0.0.0.0:8080-&gt;80/tcp   nginx
</code></pre>
<p>Nginxのコンテナが作成されていて、STATUSがUp(稼働中)であることが分かります。</p>
<h3 id="nginxのコンテナ内でbashを実行する">Nginxのコンテナ内でBashを実行する</h3>
<p>コンテナ内で何かしらのコマンドを実行したいときは、<code>docker exec</code>を使います。</p>
<pre><code>$ docker exec -it nginx /bin/bash

root@4e3aa2d731f3:/#
</code></pre>
<p>Nginxのコンテナ内で実行されたBashに繋がったかと思います。ここで<code>ls -l</code>コマンドでNginxのログフォルダを確認してみてください。</p>
<pre><code>root@4e3aa2d731f3:/# ls -l /var/log/nginx

total 0
lrwxrwxrwx 1 root root 11 Feb  2 08:06 access.log -&gt; /dev/stdout
lrwxrwxrwx 1 root root 11 Feb  2 08:06 error.log -&gt; /dev/stderr
</code></pre>
<p>ログファイルではなく、標準出力、標準エラー出力に繋がれたシンボリックリンクがありました。基本的にコンテナの世界ではログは標準出力および標準エラー出力に出力するのが習わしとなっています。そうすると、出力した文字列がDockerによってホストOSに転送され、<code>docker logs</code>コマンドで参照することができるようになります。Nginxコンテナもこれに倣ってログを標準出力、標準エラー出力に吐くよう作られているわけです。では一旦<code>exit</code>でシェルを抜けて、<code>docker logs</code>コマンドを実行してみましょう。</p>
<h3 id="nginxのログを見てみる">Nginxのログを見てみる</h3>
<pre><code>$ docker logs nginx

172.17.0.1 - - [04/Feb/2020:03:48:15 +0000] &quot;GET /robots.txt HTTP/1.1&quot; 404 555 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot; &quot;-&quot;
2020/02/04 03:48:15 [error] 6#6: *1 open() &quot;/usr/share/nginx/html/robots.txt&quot; failed (2: No such file or directory), client: 172.17.0.1, server: localhost, request: &quot;GET /robots.txt HTTP/1.1&quot;, host: &quot;localhost:8080&quot;
172.17.0.1 - - [04/Feb/2020:03:48:15 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot; &quot;-&quot;
172.17.0.1 - - [04/Feb/2020:03:48:16 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 404 555 &quot;http://localhost:8080/&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot; &quot;-&quot;
2020/02/04 03:48:16 [error] 6#6: *2 open() &quot;/usr/share/nginx/html/favicon.ico&quot; failed (2: No such file or directory), client: 172.17.0.1, server: localhost, request: &quot;GET /favicon.ico HTTP/1.1&quot;, host: &quot;localhost:8080&quot;, referrer: &quot;http://localhost:8080/&quot;
</code></pre>
<p>先程アクセスしたログが確認できるかと思います。ちなみに<code>docker logs -f</code>としてやると、<code>tail -f</code>のようにログの追記を監視することができます。</p>
<h3 id="コンテナを停止して起動する">コンテナを停止して起動する</h3>
<p>コンテナを停止するときは<code>docker stop</code>です。</p>
<pre><code>$ docker stop nginx

nginx
</code></pre>
<p>コンテナが停止し、<a href="http://localhost:8080">http://localhost:8080</a> にアクセスできなくなっているはずです。<code>docker ps</code>で状態を確認します。</p>
<pre><code>$ docker ps

docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

</code></pre>
<p>Nginxのコンテナが表示されなくなりました。ただしNginxのコンテナは停止しているだけで削除されたわけではありません。停止しているコンテナも含めて表示するには<code>docker ps -a</code>とやります。</p>
<pre><code>$ docker ps -a

docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                     PORTS               NAMES
4e3aa2d731f3        nginx:latest        &quot;nginx -g 'daemon of…&quot;   About an hour ago   Exited (0) 2 minutes ago                       nginx
</code></pre>
<p>このようにNginxのコンテナが表示され、STATUSがExitedであることが確認できます。このコンテナを再度起動するには<code>docker start</code>を実行します。</p>
<pre><code>$ docker start

nginx
</code></pre>
<p>もう一度<code>docker ps</code>コマンドを叩くと、またNginxコンテナが表示され、STATUSがUp(稼働中)であることが分かります。</p>
<pre><code>$ docker ps

CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
4e3aa2d731f3        nginx:latest        &quot;nginx -g 'daemon of…&quot;   About an hour ago   Up 23 seconds       0.0.0.0:8080-&gt;80/tcp   nginx
</code></pre>
<h3 id="コンテナを削除する">コンテナを削除する</h3>
<p>コンテナの削除は<code>docker rm</code> です。ただし、起動中のコンテナは削除できませんので、いったん<code>docker stop</code>で停止してから削除してください。</p>
<pre><code>$ docker stop nginx

nginx

$ docker rm nginx

nginx
</code></pre>
<p>これでコンテナが削除されるため、<code>docker ps -a</code>を叩いてもNginxは表示されません。</p>
<pre><code>$ docker ps -a

CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

</code></pre>
<h3 id="dockerイメージを削除する">Dockerイメージを削除する</h3>
<p>先程コンテナは削除しましたが、Dockerイメージはまだ残っています。後片付けとしてDockerイメージも削除しましょう。<code>docker rmi</code>コマンドで削除できます。</p>
<pre><code>docker rmi nginx:latest

Untagged: nginx:latest
Untagged: nginx@sha256:ad5552c786f128e389a0263104ae39f3d3c7895579d45ae716f528185b36bc6f
Deleted: sha256:2073e0bcb60ee98548d313ead5eacbfe16d9054f8800a32bedd859922a99a6e1
Deleted: sha256:a3136fbf38691346715cac8360bcdfca0fff812cede416469653670f04e2cab0
Deleted: sha256:99360ffcb2da18fd9ede194efaf5d4b90e7aee99f45737e918113e6833dcf278
Deleted: sha256:488dfecc21b1bc607e09368d2791cb784cf8c4ec5c05d2952b045b3e0f8cc01e
</code></pre>
<p>この状態で<code>docker images</code>コマンドを叩くと、NginxのDockerイメージが削除されていることが確認できるかと思います。</p>
<pre><code>$ docker images

REPOSITORY        TAG        IMAGE ID      CREATED       SIZE

</code></pre>
<p>以上でチュートリアル１は完了です。</p>
<p>ここまでの知識で、DockerHub上で公開されているDockerイメージが利用できるはずです。最近はOSSの配布をDockerで行うことが増えてきました。Dockerを使うと複雑なアプリケーション(３層アーキテクチャとか)でも簡単にインストールできます。また、コンテナはホストOSの環境と切り離されているため、ローカルPCの環境が汚れてしまう恐れもありません。コンテナを削除すると環境もろとも綺麗に削除されます。この気軽さがDockerを使う大きなメリットの一つです。DockerHubには様々なDockerイメージが公開されているので、ぜひ色々動かしてみてください。</p>
<h2 id="チュートリアル２-dockerイメージをカスタマイズする">チュートリアル２ （Dockerイメージをカスタマイズする）</h2>
<p>dockerコマンドに慣れたら、次のステップとしてオリジナルのDockerイメージの作成に挑戦してみましょう。チュートリアル２ではPythonの開発環境用にDockerイメージを作成します。</p>
<h3 id="docker-hubhttpshubdockercomでpythonを検索"><a href="https://hub.docker.com/">Docker Hub</a>でPythonを検索</h3>
<p>DockerHubにアクセスします。アカウントを持っていない人はサインアップしてください。Pythonで検索すると、PythonのDockerイメージが見つかるかと思います。</p>
<p><img src="https://i.imgur.com/i38v88q.png" alt="dockerhub1"></p>
<p>DockerHubには、公式のイメージだけでなく個人が作った信頼性の低いDockerイメージも公開されています。DockerHubを使う際は、「VERIFIED PUBLISHER」や「OFFICIAL IMAGE」のラベルがあるかどうかや、ダウンロード数、スター数を参考にして信頼性を確認するようにしましょう。</p>
<p>ではPythonを選択して、Tagsをクリックしてタグを表示してください。</p>
<p><img src="https://i.imgur.com/vbkmlby.png" alt="dockerhub2"></p>
<p>様々なタグがあることが確認できるかと思います。Pythonの場合、Python自体のバージョンと、OSのバージョンでタグが付けられているようです。ここでは<code>3.8.1-buster</code>を使うことにします。busterというのはDebianというOSのバージョン10のコードネームです。つまり、Debian10にpythonがインストールされた状態のDockerイメージということになります。</p>
<h3 id="コンテナを起動">コンテナを起動</h3>
<p><code>docker run</code>でコンテナを起動します。名前はmypythonにしました。Dockerイメージのサイズが大きいので割と時間がかかります。</p>
<pre><code>$ docker run -d -it --name mypython python:3.8.1-buster

Unable to find image 'python:3.8.1-buster' locally
3.8.1-buster: Pulling from library/python
dc65f448a2e2: Pull complete
346ffb2b67d7: Pull complete
dea4ecac934f: Pull complete
8ac92ddf84b3: Pull complete
a3ca60abc08a: Pull complete
9253bd2ee3f6: Pull complete
fad96c8dce44: Pull complete
ec0f51d2752d: Pull complete
ff10001c6dc3: Pull complete
Digest: sha256:db86894e8fcdb6ca371e1143cbc646ef554ca83c5a85dc4a13f427e085153bb5
Status: Downloaded newer image for python:3.8.1-buster
39c933d7c9a31329b8be6e3aaba62f1454f7089844b2351da5c050a3ffff5e61
</code></pre>
<p>起動できたら、コンテナ内のBashに接続して、Pythonのバージョンを確認してみます。</p>
<pre><code>docker exec -it mypython /bin/bash

root@35c8bacc3411:/# python --version
Python 3.8.1
root@35c8bacc3411:/# pip --version
pip 20.0.2 from /usr/local/lib/python3.8/site-packages/pip (python 3.8)
</code></pre>
<p>ちゃんとバージョン3.8.1がインストールされているのが確認できます。</p>
<h3 id="コンテナをカスタマイズ">コンテナをカスタマイズ</h3>
<p>このコンテナを開発環境用にカスタマイズしていきます。なんでも良いですが、今回は開発にPandasが必要になったという想定で、Pandasをインストールしてみます。</p>
<pre><code>root@35c8bacc3411:/# pip install pandas

Collecting pandas
  Downloading pandas-1.0.0-cp38-cp38-manylinux1_x86_64.whl (9.9 MB)
     |████████████████████████████████| 9.9 MB 10.1 MB/s
Collecting numpy&gt;=1.13.3
  Downloading numpy-1.18.1-cp38-cp38-manylinux1_x86_64.whl (20.6 MB)
     |████████████████████████████████| 20.6 MB 591 kB/s
Collecting pytz&gt;=2017.2
  Downloading pytz-2019.3-py2.py3-none-any.whl (509 kB)
     |████████████████████████████████| 509 kB 10.0 MB/s
Collecting python-dateutil&gt;=2.6.1
  Downloading python_dateutil-2.8.1-py2.py3-none-any.whl (227 kB)
     |████████████████████████████████| 227 kB 11.2 MB/s
Collecting six&gt;=1.5
  Downloading six-1.14.0-py2.py3-none-any.whl (10 kB)
Installing collected packages: numpy, pytz, six, python-dateutil, pandas
Successfully installed numpy-1.18.1 pandas-1.0.0 python-dateutil-2.8.1 pytz-2019.3 six-1.14.0

root@35c8bacc3411:/# python

Python 3.8.1 (default, Feb  2 2020, 08:37:37)
[GCC 8.3.0] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import pandas
&gt;&gt;&gt; exit()

root@35c8bacc3411:/#
</code></pre>
<p>インストールできました。次にこのコンテナを使って新しいmypythonという名前のDockerイメージを作成します。<code>exit</code>でシェルを抜けて、<code>docker commit</code>を実行します。</p>
<p>xxxxxの箇所はご自身のDockerHubのユーザー名に置き換えてください。</p>
<pre><code>$ docker commit mypython xxxxx/mypython:3.8.1-buster

sha256:8e8066959b691698077fc78988dbc09d77a7e586b010e690f9e22ed093da9b80

$ docker images
REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE
xxxxx/mypython              3.8.1-buster        80db86c8f1ae        5 seconds ago       1.1GB
python                      3.8.1-buster        eeadc22d21a9        47 hours ago        933MB
</code></pre>
<p>xxxxx/mypythonという名前のDockerイメージが作成されているのが確認できます。</p>
<h3 id="コンテナをdockerhubで公開する">コンテナをDockerHubで公開する</h3>
<p>このmypythonをDockerHubで公開して、他の人とシェアできるようにしてみます。それほど難しい操作は必要なく、<code>docker login</code>コマンドでDockerHubにログインし、<code>docker push</code>するだけで簡単に公開できます。</p>
<pre><code>$ docker login

(ご自身のID・パスワードでログインしてください)

$ docker push xxxxx/mypython:3.8.1-buster
</code></pre>
<p>これで、DockerHubのマイページにmypythonが表示されているはずです。DockerHubにアクセスして確認してみましょう。</p>
<p><img src="https://i.imgur.com/PT5igeH.png" alt="dockerhub3"></p>
<p>このようにDockerイメージ化することで、開発環境をチームで共有することが可能になります。Dockerが実行環境の差異を吸収してくれるので、もしチームの中にWindowsユーザーとMacユーザーとLinuxユーザーが混在していたとしても環境差異でハマることが殆どありません。環境差異に悩まなくて良いのもDockerの大きなメリットの一つです。</p>
<h3 id="dockerイメージを作成するもう一つの方法">Dockerイメージを作成するもう一つの方法</h3>
<p>先程行ったDockerイメージのカスタマイズでは、</p>
<ol>
<li>カスタマイズのベースとなるDockerイメージを使ってコンテナを起動</li>
<li>コンテナ内のBashに接続</li>
<li>何かしらをインストール</li>
<li>docker commitコマンドでオリジナルのDockerイメージを作成</li>
</ol>
<p>という流れでDockerイメージを作成しましたが、それとは別に<code>docker build</code>コマンドを使う方法もあります。<code>docker build</code>を使った方法では、まずDockerfileを作成します。(Dockerfileというファイル名です。拡張子はありません。)</p>
<p>以下がDockerfileの例です。上記の手順の1〜3をスクリプトで自動化するようなイメージです。</p>
<pre><code class="language-dockerfile">FROM python:3.8.1-buster

RUN pip install pandas
</code></pre>
<p>そして、Dockerfileのあるフォルダ上で、<code>docker build</code>コマンドを実行すると、xxxxx/mypythonという名前のDockerイメージが自動的に作成されます。</p>
<pre><code>$ docker build -t xxxxx/mypython:3.8.1-buster .

Sending build context to Docker daemon  300.6MB
Step 1/3 : FROM python:3.8.1-buster
 ---&gt; eeadc22d21a9
Step 2/3 : RUN pip install pandas
 ---&gt; Running in 290d7be35a90
Collecting pandas
  Downloading pandas-1.0.0-cp38-cp38-manylinux1_x86_64.whl (9.9 MB)
Collecting numpy&gt;=1.13.3
  Downloading numpy-1.18.1-cp38-cp38-manylinux1_x86_64.whl (20.6 MB)
Collecting python-dateutil&gt;=2.6.1
  Downloading python_dateutil-2.8.1-py2.py3-none-any.whl (227 kB)
Collecting pytz&gt;=2017.2
  Downloading pytz-2019.3-py2.py3-none-any.whl (509 kB)
Collecting six&gt;=1.5
  Downloading six-1.14.0-py2.py3-none-any.whl (10 kB)
Installing collected packages: numpy, six, python-dateutil, pytz, pandas
Successfully installed numpy-1.18.1 pandas-1.0.0 python-dateutil-2.8.1 pytz-2019.3 six-1.14.0
Removing intermediate container 290d7be35a90
 ---&gt; e67c3fa0fb05
Step 3/3 : ENTRYPOINT /bin/bash
 ---&gt; Running in 16b989c8b647
Removing intermediate container 16b989c8b647
 ---&gt; f50c90e2b7df
Successfully built f50c90e2b7df
Successfully tagged xxxxx/mypython:3.8.1-buster
</code></pre>
<p>この方法はDockerイメージの作成を自動化できるため、何度もDockerイメージを作成する必要がある場合に向いています。一般的にCIツールと組み合わせて自動化することが多いです。Dockerfileの構文を覚える必要があるので今回は時間的に解説できませんが、興味がある方は、<a href="http://docs.docker.jp/engine/reference/builder.html">Dockerfile リファレンス</a>、<a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">Best practices for writing Dockerfiles</a> などを読んでみてください。</p>
<p>以上でチュートリアル２は完了です。</p>
<h2 id="docker-tips">Docker Tips</h2>
<p>Dockerに関するTipsをいくつか紹介します。</p>
<h3 id="docker-runのオプション">docker runのオプション</h3>
<p>以下のオプションを常に付けることをおすすめします。</p>
<table>
<thead>
<tr>
<th>オプション</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>-d</td>
<td>バックグラウンドで実行</td>
</tr>
<tr>
<td>&ndash;rm</td>
<td>コンテナ停止時に自動的にコンテナを削除</td>
</tr>
<tr>
<td>&ndash;name {名前}</td>
<td>コンテナに名前を付ける</td>
</tr>
</tbody>
</table>
<p><code>-d</code>を常に付ける理由は、Dockerコンテナを不用意に停止させないためです。例えば、<code>-d</code>を付けずに実行すると、</p>
<pre><code>$ docker run -it --name mypython python:3.8.1-buster /bin/bash

root@da3508c54ee2:/# exit
exit

$ docker ps

CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

</code></pre>
<p>というように、プロセスが終了するとコンテナが停止してしまいます。デタッチ/アタッチという仕組みもありますが、それをやるなら<code>-d</code>を使うほうが簡単です。</p>
<pre><code>$ docker run -d -it --name mypython python:3.8.1-buster

13b59f84fc3d68f53c244e0801c336f6f439dce75a359ac1b5f05e96753c1bd9

$ docker exec -it mypython /bin/bash

root@13b59f84fc3d:/# exit
exit

$ docker ps

CONTAINER ID        IMAGE                 COMMAND             CREATED             STATUS              PORTS               NAMES
13b59f84fc3d        python:3.8.1-buster   &quot;/bin/bash&quot;         9 seconds ago       Up 7 seconds                            mypython
</code></pre>
<p>このように、コンテナのシェルには<code>docker exec</code>で接続します。この方法だとシェルを抜けてもコンテナは停止しません。停止したいときは<code>docker stop</code>で明示的に停止します。</p>
<p><code>--rm</code>を付ける理由としては、コンテナを停止状態で置いておく必要がないからです。なのでコンテナを停止したら勝手に削除してくれたほうがコンテナを削除する手間が省けます。コンテナの中で作成したファイルを消したくないというケースはあるかと思いますが、それであれば<code>docker run</code>時にホストOSのフォルダをマウントしてホストOS側に保存するか、もしくは<code>docker commit</code>でDockerイメージ化したほうが安全です。「コンテナを誤って削除してしまった」という事故を防げます。</p>
<p><code>--name</code>を付ける理由は、これをしないとDockerに割り当てられたランダムな単語を使ってコンテナの操作をしなければならなくなるからです。</p>
<pre><code>$ docker run -d -it --rm python:3.8.1-buster
783aab3c9c46dda9ad44e8289871f1ac0594698ef85799b93da43587b357f336
d

$ docker ps

CONTAINER ID        IMAGE                 COMMAND             CREATED             STATUS                  PORTS               NAMES
783aab3c9c46        python:3.8.1-buster   &quot;/bin/bash&quot;         1 second ago        Up Less than a second                       romantic_rhodes
</code></pre>
<p>というように、この場合では<code>romantic_rhodes</code>という名前か、もしくはCONTAINER IDを使わなければならず、操作性が低くなります。</p>
<h3 id="docker-runのコマンドが長くて見づらい">docker runのコマンドが長くて見づらい</h3>
<p>オプションが多くなった場合は、バックスラッシュで改行すると見やすいです。
（Windowsはキャレットで改行できる？）</p>
<pre><code>$ docker run \
    -d \
    -it \
    --rm \
    --name mypython \
    python:3.8.1-buster
</code></pre>
<h3 id="dockerイメージのゴミを削除したい">Dockerイメージのゴミを削除したい</h3>
<p>Dockerを使っていると、Dockerイメージのゴミが溜まってきます。そんなときは<code>docker system prune</code>とやると掃除できます。たまに実行すると良いかと思います。</p>
<pre><code>$ docker system prune

WARNING! This will remove:
  - all stopped containers
  - all networks not used by at least one container
  - all dangling images
  - all dangling build cache

Are you sure you want to continue? [y/N] y
Deleted Images:
untagged: koirand/mypython@sha256:09973f3e3a51d59d5d57306b928a3c24ee4cbd8baeda46ab60e3810e38c1d9d4
deleted: sha256:80db86c8f1ae595cedd7d909156bd0638e21ab7c6b6da48af57fff58bdd30e31
deleted: sha256:70eca39dc93885416684888ad63f2e68133c848e0708ffba0681d5938cfb6936
deleted: sha256:142edfeafc60e404b5038812ede95e8a5fb902b6e041231d9e0304eab7127a37
deleted: sha256:ef94e002c5727977623f12810fc8e8c45c8c89d80ec1d613c059e85b222bc61f
deleted: sha256:3f70246ee63ab87ba8717df29a81c7b5eb0812493da7e03b0c23363ec3513661
deleted: sha256:f5e1b6e88039e92cad924d47fafe4c0c533914cf2d8d136396f47e22e99a6f62
deleted: sha256:7d31605ba9a91ad8c70438b2dbb8fee6f599b165137f03a58b918274dbd106eb
deleted: sha256:930f81dcf389890495ca1103ab4361718b4dc51a1d149b88454424566e76293b
deleted: sha256:899090de47ef18ae38c91752ae5d3d91bcea683c0b7a1610d92a56a61f82e694
deleted: sha256:014bf9ec8a38021ca309be775d9bbd55be782417b03e79b53fda9e43dc1261d4
deleted: sha256:05e4bef6d74ab30ceda651deaf8cf5098493ae4b3637f80cc84d0d4d39e008a8
deleted: sha256:a2e778d0eb88ab6a02ff378eb3605d9bdf34fef5545427a22312bb0cb85729ef
deleted: sha256:f1c46cc442566e473088a0cd5ea74e6da8bcbe4456f041e461e721d7c2f29e8c
deleted: sha256:66e1bbe79ff4646f032b7aeaa8acda8bf28fbac489dc55a403cb2d025a56ee9a
deleted: sha256:96c1612de1b3dea0b223faafdbde1553e17697468b5951456d338105bf208de3

Total reclaimed space: 447.5MB
</code></pre>
<h3 id="vscode拡張機能">VSCode拡張機能</h3>
<p>VSCodeの便利な拡張機能を紹介します。</p>
<h4 id="docker---visual-studio-marketplacehttpsmarketplacevisualstudiocomitemsitemnamems-azuretoolsvscode-docker"><a href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker">Docker - Visual Studio Marketplace</a></h4>
<p>これを入れると、ツールバーにDockerアイコンが表示され、コンテナの操作をGUIで行うことができます。(さっき紹介したゴミの削除もできます。)</p>
<p><img src="https://i.imgur.com/XZTHFnt.png" alt="vscode1"></p>
<h4 id="remote---containers---visual-studio-marketplacehttpsmarketplacevisualstudiocomitemsitemnamems-vscode-remoteremote-containers"><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers">Remote - Containers - Visual Studio Marketplace</a></h4>
<p>これはまだプレビューですが、VSCodeからコンテナに直接アクセスできる革命的な拡張機能です。</p>
<p><img src="https://i.imgur.com/0AcI9pP.png" alt="vscode2"></p>
<h3 id="エイリアス">エイリアス</h3>
<p>毎回<code>docker</code>を打つのがダルいという人はエイリアスを設定すると良いかと思います。</p>
<pre><code>alias d=&quot;docker&quot;
</code></pre>
<p>以上、Docker入門講座でした。お疲れさまでした。</p>

  </div>
  <footer>
  <p>
  &copy; 2018 Kazuki Koide.
  Powered by <a href="https://gohugo.io/">Hugo</a>
  using the <a href="https://github.com/koirand/pulp/">pulp</a> theme.
  </p>
</footer>


  </body>
</html>
